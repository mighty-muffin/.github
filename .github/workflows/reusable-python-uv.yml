---
name: Reusable - Python UV

on: # yamllint disable-line rule:truthy
  workflow_call:
    inputs:
      python_file:
        description: Python version to use
        type: string
        required: false
        default: ".python-version"
      python_version:
        description: Python version to use
        type: string
        required: false
        default: "3.13"
      ruff_version:
        description: Ruff version to use
        type: string
        required: false
        default: "0.8.0"
      uv_version:
        description: UV version to use
        type: string
        required: false
        default: "0.7.11"
      working_directory:
        description: Project working directory
        type: string
        required: false
        default: ""

jobs:
  python-poetry:
    name: Python - UV
    runs-on: ubuntu-24.04
    timeout-minutes: 5

    defaults:
      run:
        shell: bash
        working-directory: ${{ inputs.working_directory }}

    steps:
      - name: Checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0

      - name: Install UV
        uses: astral-sh/setup-uv@557e51de59eb14aaaba2ed9621916900a91d50c6 # v6.6.1
        with:
          enable-cache: true
          cache-dependency-glob: "uv.lock"
          version: ${{ inputs.uv_version }}

      - name: Set up python
        id: setup-python
        uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065 # v5.6.0
        with:
          python-version: ${{ inputs.python_version || '3.13' }}
          # python-version-file: ${{ inputs.python_file || 'pyproject.toml' }}

      - name: Restore UV cache
        uses: actions/cache@0400d5f644dc74513175e3cd8d07132dd4860809 # v4
        with:
          path: ~/.cache/uv-cache
          key: uv-${{ runner.os }}-${{ hashFiles('uv.lock') }}
          restore-keys: |
            uv-${{ runner.os }}-${{ hashFiles('uv.lock') }}
            uv-${{ runner.os }}

      - name: Install dependencies
        run: |
          uv sync --all-extras --dev --frozen

      - name: Install dependencies
        uses: astral-sh/ruff-action@57714a7c8a2e59f32539362ba31877a1957dded1 # v3.5.1
        with:
          version: ${{ inputs.ruff_version }}
          args: check

      - name: Pytest - Run Unit Test
        run: |
          uv run pytest

      - name: Minimize UV cache
        run: |
          uv cache prune --ci
